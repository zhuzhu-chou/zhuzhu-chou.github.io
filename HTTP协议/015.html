<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS | 猪猪的秋招历险记</title>
    <meta name="description" content="zhuzhu-chou">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.d824222e.css" as="style"><link rel="preload" href="/assets/js/app.d821a795.js" as="script"><link rel="preload" href="/assets/js/29.0c4b19bd.js" as="script"><link rel="prefetch" href="/assets/js/10.e3f9d51e.js"><link rel="prefetch" href="/assets/js/100.e7c2e2a2.js"><link rel="prefetch" href="/assets/js/101.6c07d27a.js"><link rel="prefetch" href="/assets/js/102.887c413c.js"><link rel="prefetch" href="/assets/js/103.1d6d61be.js"><link rel="prefetch" href="/assets/js/104.e55ee457.js"><link rel="prefetch" href="/assets/js/105.412e30b0.js"><link rel="prefetch" href="/assets/js/106.c47f4df5.js"><link rel="prefetch" href="/assets/js/107.870b439e.js"><link rel="prefetch" href="/assets/js/108.4ec851bb.js"><link rel="prefetch" href="/assets/js/109.b07bd02b.js"><link rel="prefetch" href="/assets/js/11.d6d192f4.js"><link rel="prefetch" href="/assets/js/110.128281e6.js"><link rel="prefetch" href="/assets/js/111.4663864c.js"><link rel="prefetch" href="/assets/js/112.6047dd13.js"><link rel="prefetch" href="/assets/js/113.b8082ad5.js"><link rel="prefetch" href="/assets/js/114.b6ae0466.js"><link rel="prefetch" href="/assets/js/115.cf48bc1f.js"><link rel="prefetch" href="/assets/js/116.34d6c0af.js"><link rel="prefetch" href="/assets/js/117.58d44fab.js"><link rel="prefetch" href="/assets/js/118.ce894f2e.js"><link rel="prefetch" href="/assets/js/119.e2a7b804.js"><link rel="prefetch" href="/assets/js/12.40971e3f.js"><link rel="prefetch" href="/assets/js/120.011d3136.js"><link rel="prefetch" href="/assets/js/121.b169830b.js"><link rel="prefetch" href="/assets/js/122.786c3828.js"><link rel="prefetch" href="/assets/js/123.01d1848a.js"><link rel="prefetch" href="/assets/js/124.c441a520.js"><link rel="prefetch" href="/assets/js/125.21cdb4f9.js"><link rel="prefetch" href="/assets/js/126.e45c2624.js"><link rel="prefetch" href="/assets/js/127.ac38254f.js"><link rel="prefetch" href="/assets/js/128.f6d4d0bc.js"><link rel="prefetch" href="/assets/js/129.5a419e08.js"><link rel="prefetch" href="/assets/js/13.d1c5fbb0.js"><link rel="prefetch" href="/assets/js/130.de9b47d3.js"><link rel="prefetch" href="/assets/js/131.9646ee89.js"><link rel="prefetch" href="/assets/js/14.e34de0ff.js"><link rel="prefetch" href="/assets/js/15.472488b8.js"><link rel="prefetch" href="/assets/js/16.374db90a.js"><link rel="prefetch" href="/assets/js/17.5abb1dfa.js"><link rel="prefetch" href="/assets/js/18.c53d9795.js"><link rel="prefetch" href="/assets/js/19.695813fa.js"><link rel="prefetch" href="/assets/js/2.190ddb3b.js"><link rel="prefetch" href="/assets/js/20.a839cd57.js"><link rel="prefetch" href="/assets/js/21.4cb2c381.js"><link rel="prefetch" href="/assets/js/22.9ea4cd56.js"><link rel="prefetch" href="/assets/js/23.1c401a4a.js"><link rel="prefetch" href="/assets/js/24.09aeca42.js"><link rel="prefetch" href="/assets/js/25.de21a5fc.js"><link rel="prefetch" href="/assets/js/26.86fdb144.js"><link rel="prefetch" href="/assets/js/27.1902cbeb.js"><link rel="prefetch" href="/assets/js/28.d7221b51.js"><link rel="prefetch" href="/assets/js/3.a442116a.js"><link rel="prefetch" href="/assets/js/30.e86fdd69.js"><link rel="prefetch" href="/assets/js/31.627ce7d6.js"><link rel="prefetch" href="/assets/js/32.cd4da21e.js"><link rel="prefetch" href="/assets/js/33.02a73b45.js"><link rel="prefetch" href="/assets/js/34.15aefe4e.js"><link rel="prefetch" href="/assets/js/35.001e95e9.js"><link rel="prefetch" href="/assets/js/36.f84a31ae.js"><link rel="prefetch" href="/assets/js/37.454325b3.js"><link rel="prefetch" href="/assets/js/38.87055225.js"><link rel="prefetch" href="/assets/js/39.257a4c49.js"><link rel="prefetch" href="/assets/js/4.d1e9d328.js"><link rel="prefetch" href="/assets/js/40.2e2df2e4.js"><link rel="prefetch" href="/assets/js/41.d00e84a7.js"><link rel="prefetch" href="/assets/js/42.ab66a6dc.js"><link rel="prefetch" href="/assets/js/43.a93faa3d.js"><link rel="prefetch" href="/assets/js/44.68edf81d.js"><link rel="prefetch" href="/assets/js/45.cecb8a02.js"><link rel="prefetch" href="/assets/js/46.39db2fdd.js"><link rel="prefetch" href="/assets/js/47.a37ba526.js"><link rel="prefetch" href="/assets/js/48.aad0e3f7.js"><link rel="prefetch" href="/assets/js/49.1364378d.js"><link rel="prefetch" href="/assets/js/5.7c48898c.js"><link rel="prefetch" href="/assets/js/50.b454c855.js"><link rel="prefetch" href="/assets/js/51.975f3695.js"><link rel="prefetch" href="/assets/js/52.b14c05b8.js"><link rel="prefetch" href="/assets/js/53.a81e51d9.js"><link rel="prefetch" href="/assets/js/54.0aeecb53.js"><link rel="prefetch" href="/assets/js/55.a31903b4.js"><link rel="prefetch" href="/assets/js/56.c109660e.js"><link rel="prefetch" href="/assets/js/57.1c308b8b.js"><link rel="prefetch" href="/assets/js/58.d4357baa.js"><link rel="prefetch" href="/assets/js/59.14a4c834.js"><link rel="prefetch" href="/assets/js/6.7e06078c.js"><link rel="prefetch" href="/assets/js/60.f4887bd5.js"><link rel="prefetch" href="/assets/js/61.5e7bbbf3.js"><link rel="prefetch" href="/assets/js/62.3a1a0a65.js"><link rel="prefetch" href="/assets/js/63.8702baf6.js"><link rel="prefetch" href="/assets/js/64.f5bd3f4f.js"><link rel="prefetch" href="/assets/js/65.204fd742.js"><link rel="prefetch" href="/assets/js/66.e6f9fa2e.js"><link rel="prefetch" href="/assets/js/67.657fbd99.js"><link rel="prefetch" href="/assets/js/68.2665ac26.js"><link rel="prefetch" href="/assets/js/69.e09f9aee.js"><link rel="prefetch" href="/assets/js/7.6067a04e.js"><link rel="prefetch" href="/assets/js/70.c8081156.js"><link rel="prefetch" href="/assets/js/71.4bfa1695.js"><link rel="prefetch" href="/assets/js/72.9c9e4b3b.js"><link rel="prefetch" href="/assets/js/73.367500e5.js"><link rel="prefetch" href="/assets/js/74.334b5675.js"><link rel="prefetch" href="/assets/js/75.e70148f8.js"><link rel="prefetch" href="/assets/js/76.e099e1e8.js"><link rel="prefetch" href="/assets/js/77.ca3873ff.js"><link rel="prefetch" href="/assets/js/78.47cf4f3b.js"><link rel="prefetch" href="/assets/js/79.de61ae29.js"><link rel="prefetch" href="/assets/js/8.f956270d.js"><link rel="prefetch" href="/assets/js/80.e2023d3e.js"><link rel="prefetch" href="/assets/js/81.db665f6c.js"><link rel="prefetch" href="/assets/js/82.0fcbe517.js"><link rel="prefetch" href="/assets/js/83.f546847b.js"><link rel="prefetch" href="/assets/js/84.332592a6.js"><link rel="prefetch" href="/assets/js/85.ea13def4.js"><link rel="prefetch" href="/assets/js/86.50c7ec50.js"><link rel="prefetch" href="/assets/js/87.93f71ee2.js"><link rel="prefetch" href="/assets/js/88.0daff6bc.js"><link rel="prefetch" href="/assets/js/89.1c6d7c6c.js"><link rel="prefetch" href="/assets/js/9.59ce1950.js"><link rel="prefetch" href="/assets/js/90.9b2e9f20.js"><link rel="prefetch" href="/assets/js/91.89de4b55.js"><link rel="prefetch" href="/assets/js/92.447d9f68.js"><link rel="prefetch" href="/assets/js/93.d924823b.js"><link rel="prefetch" href="/assets/js/94.a9b22af4.js"><link rel="prefetch" href="/assets/js/95.5ad985f1.js"><link rel="prefetch" href="/assets/js/96.3af25c39.js"><link rel="prefetch" href="/assets/js/97.d244818c.js"><link rel="prefetch" href="/assets/js/98.3af13f67.js"><link rel="prefetch" href="/assets/js/99.2173d072.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d824222e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">猪猪的秋招历险记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">前端基础</a></div><div class="nav-item"><a href="https://github.com/thinkerHope/algorithm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法题库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/others/" class="nav-link">诗和远方</a></div><div class="nav-item"><a href="/HTTP%E5%8D%8F%E8%AE%AE/thinkerhope.github.io.html" class="nav-link">博客</a></div><div class="nav-item"><a href="https://github.com/thinkerHope" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">前端基础</a></div><div class="nav-item"><a href="https://github.com/thinkerHope/algorithm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法题库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/others/" class="nav-link">诗和远方</a></div><div class="nav-item"><a href="/HTTP%E5%8D%8F%E8%AE%AE/thinkerhope.github.io.html" class="nav-link">博客</a></div><div class="nav-item"><a href="https://github.com/thinkerHope" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>前端知识体系</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS-V8引擎原理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS-其它API原理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS-基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS-异步编程及异步IO</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>HTTP协议</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/HTTP协议/001.html" class="sidebar-link">001.Cookie的理解</a></li><li><a href="/HTTP协议/002.html" class="sidebar-link">002.跨域</a></li><li><a href="/HTTP协议/003.html" class="sidebar-link">003.GET和POST请求的区别</a></li><li><a href="/HTTP协议/004.html" class="sidebar-link">004.HTTP的特点以及缺点</a></li><li><a href="/HTTP协议/005.html" class="sidebar-link">005.对Content字段的了解</a></li><li><a href="/HTTP协议/006.html" class="sidebar-link">006.HTTP通用首部字段</a></li><li><a href="/HTTP协议/007.html" class="sidebar-link">007.HTTP是如何定长和不定长数据的</a></li><li><a href="/HTTP协议/008.html" class="sidebar-link">008.HTTP如何处理大文件的传输</a></li><li><a href="/HTTP协议/009.html" class="sidebar-link">009.HTTP如何处理表单数据的提交</a></li><li><a href="/HTTP协议/010.html" class="sidebar-link">010.HTTP代理</a></li><li><a href="/HTTP协议/011.html" class="sidebar-link">011.HTTP代理缓存</a></li><li><a href="/HTTP协议/012.html" class="sidebar-link">012.HTTP与队头阻塞</a></li><li><a href="/HTTP协议/013.html" class="sidebar-link">013.HTTP/2有哪些改进</a></li><li><a href="/HTTP协议/014.html" class="sidebar-link">014.二进制分帧的设计</a></li><li><a href="/HTTP协议/015.html" class="active sidebar-link">HTTPS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HTTP协议/015.html#传统-rsa-版本" class="sidebar-link">传统 RSA 版本</a></li><li class="sidebar-sub-header"><a href="/HTTP协议/015.html#tls-1-2-握手过程" class="sidebar-link">TLS/1.2 握手过程</a></li><li class="sidebar-sub-header"><a href="/HTTP协议/015.html#tls-1-3-握手过程的改进" class="sidebar-link">TLS 1.3 握手过程的改进</a></li><li class="sidebar-sub-header"><a href="/HTTP协议/015.html#https-和-http-的区别" class="sidebar-link">HTTPS 和 HTTP 的区别</a></li></ul></li><li><a href="/HTTP协议/016.html" class="sidebar-link">016.HTTP状态码</a></li><li><a href="/HTTP协议/017.html" class="sidebar-link">017.HTTP 字段 host、referer、origin</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>TCP协议</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Chromium-渲染篇</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Chromium-安全篇</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>计网</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>os</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p><strong>对称加密和非对称加密</strong></p> <ul><li><strong>对称加密</strong>：最简单的方式，指的是加密和解密用的是同样的密钥。</li> <li><strong>非对称加密</strong>：如果有 A、B 两把密钥，用 A 加密过的数据包只能用 B 解密，反之，B 加密过必须用 A 解密。</li></ul> <h2 id="传统-rsa-版本"><a href="#传统-rsa-版本" class="header-anchor">#</a> 传统 RSA 版本</h2> <p>如果传输过程遇到 <strong>DNS 劫持</strong>，将目标地址替换为劫持黑客的服务器，然后黑客自己造一份公钥和私钥，照样可以进行数据传输。HTTPS 在上述对称加密和非对称加密基础上，又添加了数字证书认证的步骤。目的是让服务器证明自己的身份。</p> <p>服务器唯一保存着密钥，传给客户端的数字证书包含了公钥。公钥加密，私钥解密，可知 RSA 采用非对称加密。</p> <p><a href="http://47.98.159.95/my_blog/week12/1.jpg" target="_blank" rel="noopener noreferrer"><img src="http://47.98.159.95/my_blog/week12/1.jpg" alt="project"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="tls-1-2-握手过程"><a href="#tls-1-2-握手过程" class="header-anchor">#</a> <code>TLS/1.2</code> 握手过程</h2> <p>上诉加解密之所以成为 RSA 版本，是因为解密 <code>pre_random</code>  的时候采用了 <strong><code>RSA 算法</code></strong></p> <p>TLS 1.2 版本的加解密流程：</p> <p><a href="http://47.98.159.95/my_blog/http/010.jpg" target="_blank" rel="noopener noreferrer"><img src="http://47.98.159.95/my_blog/http/010.jpg" alt="img"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><p><strong>Step 1</strong>：<strong>Client Hello</strong></p> <p><code>client_random</code> 为后面生成最终 <code>secrect</code> 的一个参数。</p> <p>加密套件一般长这样：</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>TLS_ECDHE_WITH_AES_128_GCM_SHA256
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>意思是<code>TLS</code>握手过程中，使用<code>ECDHE</code>算法生成<code>pre_random</code>(这个数后面会介绍)，128位的<code>AES</code>算法进行对称加密，在对称加密的过程中使用主流的<code>GCM</code>分组模式，因为对称加密中很重要的一个问题就是如何分组。最后一个是<strong>哈希摘要算法</strong>，采用<code>SHA256</code>算法。</p> <blockquote><p>哈希摘要算法：在 TLS 握手过程中用于将服务端的证书信息生成一个摘要（可以理解为<strong>比较短的字符串</strong>），用来表识这个服务器的身份，然后把加密后的标识和公钥传给客户端，客户端会用公钥解密，生成另外一份摘要。两个摘要进行对比，相同则认证成功。其中除了用到了哈希算法，最重要的过程是私钥加密，然后服务端用传来的公钥解密。</p></blockquote></li> <li><p><strong>Step 2</strong>：<strong>Server Hello</strong></p> <p><code>server_random</code> 也是最后生成 <code>secrect</code> 的一个参数。</p></li> <li><p><strong>Step3：Client 验证证书，生成 secret</strong></p> <p>基于 <strong><code>ECDHE 算法（对称加密算法</code></strong>）计算出 <code>pre_random</code>。</p> <p>客户端现在拥有了<code>client_random</code>、<code>server_random</code>和<code>pre_random</code>，接下来将这三个数通过一个伪随机数函数来计算出最终的<code>secret</code>。</p></li> <li><p><strong>Step4：Server 生成 secrect</strong></p> <p>注意客户端是先生成 <strong><code>client_params</code></strong> ，再用 <strong><code>ECDHE 算法</code><strong>生成 <code>pre_random</code>。客户端生成 <code>client_params</code> 之后就传给服务器，服务器同样采用 <strong><code>ECDHE 算法</code></strong>，生成 pre_random，之后服务端也拥有了 client_random、server_random和 pre_random，采用和客户端一样的</strong>伪随机函数</strong>生成 <code>secrect</code>。</p></li></ul> <p><strong>RSA 和 ECDHE 握手过程的区别</strong></p> <ul><li>TLS1.2 握手中，使用<code>ECDHE</code>实现<code>pre_random</code>的加密解密，没有用到 RSA。</li> <li>使用 ECDHE 还有一个特点，就是客户端发送完收尾消息后可以提前<code>抢跑</code>，直接发送 HTTP 报文，节省了一个 <strong><code>RTT（往返时延</code></strong>），不必等到收尾消息到达服务器，然后等服务器返回收尾消息给自己，直接开始发请求。这也叫<code>TLS False Start</code>。</li></ul> <h2 id="tls-1-3-握手过程的改进"><a href="#tls-1-3-握手过程的改进" class="header-anchor">#</a> <code>TLS 1.3</code> 握手过程的改进</h2> <h3 id="强化安全"><a href="#强化安全" class="header-anchor">#</a> 强化安全</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>RSA算法不具备<strong>前向安全性</strong>，而E CDHE 具备，因此在 TLS1.3 中彻底取代了 RSA</p></div> <p><strong>解释一下什么是前向安全性</strong>：</p> <p>RSA 握手过程中，服务器私钥泄露后，并且中间人截获之前所有报文的时候，就能拿到 client_random、server_random 和 pre_random 并且使用对应的随机数函数生成 secret，也就是拿到了 TLS 最终的会话密钥，每一个历史报文都能通过这样的方式破解。</p> <p>而 ECDHE 在每次握手时都会生成临时的密钥对，即使私钥破解，之前的历史记录也不受影响，这种一次破解不影响历史信息的性质叫前向安全性。</p> <h3 id="提升性能"><a href="#提升性能" class="header-anchor">#</a> 提升性能</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>和 TLS 1.2 相比少了一个 RTT</p></div> <p>流程如下: <a href="http://47.98.159.95/my_blog/http/011.jpg" target="_blank" rel="noopener noreferrer"><img src="http://47.98.159.95/my_blog/http/011.jpg" alt="img"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>TLS 1.3 握手方式也被叫做<strong>1-RTT握手</strong>。</p> <p>服务端不必等待对方验证证书之后才拿到<code>client_params</code>，而是直接在第一次握手的时候就能够拿到, 拿到之后立即计算<code>secret</code>。</p> <h3 id="会话复用"><a href="#会话复用" class="header-anchor">#</a> 会话复用</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>会话复用有两种方式: <strong>Session ID</strong>和<strong>Session Ticket</strong>。</p></div> <ul><li><p>最早出现的 <strong><code>Session ID</code></strong>：客户端和服务端首次连接后各自保存会话的 ID，并存储会话密钥，当再次连接时，客户端发送 ID 过来，服务端查找这个 ID 是否存在，找到了就复用之前的会话状态，会话密钥就不用重新生成了，直接用原来那份。</p></li> <li><p>但 Session ID 有个弊端：当客户端数量庞大时，服务器存储压力会很大。</p> <p>因此出现 <strong><code>Session Ticket</code></strong>。**思路是：既然服务端压力大，就分摊到客户端。**具体来说，</p> <p>首次连接之后，服务器将通过 <strong><code>ticket key</code></strong> 密钥将会话状态加密生成一个 ticket，然后发送给客户端，再次连接时，客户端发送 ticket 给服务端，用 ticket key 解密，验证过期时间，拿出里面的<strong>会话状态（包括会话密钥）</strong>。</p> <p>提高了性能，但是带来了安全问题。为了保证前向安全性，需要对这个 ticket key 进行轮转变化，不过重点是在轮转的过程中需要兼容老的 ticket key，用新的 ticket key 进行加解密，用老的 ticket key 只进行解密，最终慢慢淘汰掉老的 ticket key。从而安全的复用效果。</p> <blockquote><p>目前有较多的方法来轮转这个ticket key。我们公司目前采用的是 cloudflare 公司开源出来的轮转方式，每小时轮转一次。</p></blockquote></li></ul> <h3 id="psk"><a href="#psk" class="header-anchor">#</a> PSK</h3> <p>::; tip</p> <p>1-RTT 优化到 0-RTT</p> <p>:::</p> <p>刚刚说的都是<code>1-RTT</code>情况下的优化，那能不能优化到<code>0-RTT</code>呢？</p> <p>答案是可以的。做法其实也很简单，在发送<strong>Session Ticket</strong>的同时带上应用数据，不用等到服务端确认，这种方式被称为<code>Pre-Shared Key</code>，即 <strong><code>PSK</code></strong>。</p> <p>这种方式虽然方便，但也带来了安全问题。中间人截获<code>PSK</code>的数据，不断向服务器重复发，类似于 TCP 第一次握手携带数据，增加了服务器被攻击的风险。</p> <h2 id="https-和-http-的区别"><a href="#https-和-http-的区别" class="header-anchor">#</a> <code>HTTPS</code> 和 <code>HTTP</code> 的区别</h2> <ol><li>Https协议需要ca证书，费用较高。</li> <li>http是超文本传输协议，信息是明文传输，https则是加密传输协议。</li> <li>http协议的默认端口为80，https的端口为443</li> <li>http的连接很简单，是无状态的；HTTPS协议是由TLS+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。</li></ol></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.d821a795.js" defer></script><script src="/assets/js/29.0c4b19bd.js" defer></script>
  </body>
</html>
