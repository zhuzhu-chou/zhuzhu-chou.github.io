(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{279:function(_,v,o){"use strict";o.r(v);var e=o(0),t=Object(e.a)({},(function(){var _=this.$createElement;this._self._c;return this._m(0)}),[function(){var _=this,v=_.$createElement,o=_._self._c||v;return o("div",{staticClass:"content"},[o("blockquote",[o("p",[_._v("TFO，也就是 TCP 快速打开("),o("code",[_._v("TCP Fast Open")]),_._v(")，是优化后的 TCP 握手流程")])]),_._v(" "),o("p",[_._v("优化的过程是这样的，还记得我们说 SYN Flood 攻击时提到的 SYN Cookie 吗？这个 Cookie 可不是浏览器的"),o("code",[_._v("Cookie")]),_._v("， 用它同样可以实现 TFO。")]),_._v(" "),o("ul",[o("li",[o("p",[o("strong",[_._v("TFO 流程")])]),_._v(" "),o("p",[o("strong",[_._v("首轮三次握手")])]),_._v(" "),o("p",[_._v("首先客户端发送"),o("code",[_._v("SYN")]),_._v("给服务端，服务端接收到。")]),_._v(" "),o("p",[_._v("注意哦！现在服务端不是立刻回复 SYN + ACK，而是通过计算得到一个"),o("code",[_._v("SYN Cookie")]),_._v(", 将这个"),o("code",[_._v("Cookie")]),_._v("放到 TCP 报文的 "),o("code",[_._v("Fast Open")]),_._v("选项中，然后才给客户端返回。")]),_._v(" "),o("p",[_._v("客户端拿到这个 Cookie 的值缓存下来。后面正常完成三次握手。")]),_._v(" "),o("p",[_._v("首轮三次握手就是这样的流程。而后面的三次握手就不一样啦！")]),_._v(" "),o("p",[o("strong",[_._v("后面的三次握手")])]),_._v(" "),o("p",[_._v("在后面的三次握手中，客户端会将之前缓存的 "),o("code",[_._v("Cookie")]),_._v("、"),o("code",[_._v("SYN")]),_._v(" 和"),o("code",[_._v("HTTP请求")]),_._v("(是的，你没看错)发送给服务端，服务端验证了 Cookie 的合法性，如果不合法直接丢弃；如果是合法的，那么就正常返回"),o("code",[_._v("SYN + ACK")]),_._v("。")]),_._v(" "),o("p",[_._v("重点来了，现在服务端能向客户端发 HTTP 响应了！这是最显著的改变，三次握手还没建立，仅仅验证了 Cookie 的合法性，就可以返回 HTTP 响应了。")]),_._v(" "),o("p",[_._v("当然，客户端的"),o("code",[_._v("ACK")]),_._v("还得正常传过来，不然怎么叫三次握手嘛。")]),_._v(" "),o("p",[_._v("流程如下：")]),_._v(" "),o("p",[o("img",{attrs:{src:"https://zhuzhu-chou.github.io/images/007.jpg",alt:""}})]),_._v(" "),o("p",[o("strong",[_._v("注意:")]),_._v(" 客户端最后握手的 ACK 不一定要等到服务端的 HTTP 响应到达才发送，两个过程没有任何关系。")])]),_._v(" "),o("li",[o("p",[o("strong",[_._v("TFO 优势")])]),_._v(" "),o("p",[_._v("TFO 的优势并不在与首轮三次握手，而在于后面的握手，在拿到客户端的 Cookie 并验证通过以后，可以直接返回 HTTP 响应，充分利用了"),o("strong",[_._v("1 个RTT")]),_._v("的时间"),o("strong",[_._v("提前进行数据传输")]),_._v("，积累起来还是一个比较大的优势。")])])])])}],!1,null,null,null);v.default=t.exports}}]);