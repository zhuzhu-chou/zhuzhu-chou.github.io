(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{202:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this.$createElement;this._self._c;return this._m(0)}),[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h3",{attrs:{id:"xss的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss的理解"}},[s._v("#")]),s._v(" XSS的理解")]),s._v(" "),a("p",[a("code",[s._v("xss")]),s._v(" 指的是攻击者往Web页面里注入恶意 "),a("code",[s._v("html")]),s._v(" 标签或者 "),a("code",[s._v("javascript")]),s._v(" 代码，对用户浏览器进行控制或者获取用户隐私信息。")]),s._v(" "),a("p",[a("strong",[s._v("类型和场景：")])]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("反射性（非持久型）：")])]),s._v(" "),a("p",[s._v("比如我输入:")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('http://sanyuan.com?q=<script>alert("你完蛋了")<\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这样，在服务器端会拿到"),a("code",[s._v("q")]),s._v("参数,然后将内容返回给浏览器端，浏览器将这些内容作为HTML的一部分解析，发现是一个脚本，直接执行，这样就被攻击了。")]),s._v(" "),a("p",[s._v("之所以叫它"),a("code",[s._v("反射型")]),s._v(", 是因为恶意脚本是通过作为网络请求的参数，经过服务器，然后再反射到HTML文档中，执行解析。和"),a("code",[s._v("存储型")]),s._v("不一样的是，服务器并不会存储这些恶意脚本。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("存储型（持久型）：")])]),s._v(" "),a("p",[s._v("存储型 XSS 漏洞危害要比反射型的大。")]),s._v(" "),a("p",[s._v("场景：留言板或者文章中。用户在要发表的文章或者留言上写入恶意 JS 脚本，并且网站没有任何防护措施的话，脚本会保存到后端数据库中，其它用户浏览该文章或者留言的页面就会执行恶意脚本了。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("基于 DOM")])]),s._v(" "),a("p",[s._v("文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后"),a("strong",[s._v("修改里面的 html 文档")]),s._v("！")]),s._v(" "),a("p",[s._v("这样的劫持方式包括"),a("code",[s._v("WIFI路由器劫持")]),s._v("或者"),a("code",[s._v("本地恶意软件")]),s._v("等。")])])]),s._v(" "),a("h3",{attrs:{id:"xss-防范措施："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-防范措施："}},[s._v("#")]),s._v(" "),a("strong",[a("code",[s._v("XSS")]),s._v(" 防范措施：")])]),s._v(" "),a("p",[s._v("明白了三种"),a("code",[s._v("XSS")]),s._v("攻击的原理，我们能发现一个共同点: 都是让恶意脚本直接能在浏览器中执行。")]),s._v(" "),a("p",[s._v("那么要防范它，就是要避免这些脚本代码的执行。")]),s._v(" "),a("p",[s._v("为了完成这一点，必须做到"),a("strong",[s._v("一个信念，两个利用")])]),s._v(" "),a("h4",{attrs:{id:"一个信念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个信念"}},[s._v("#")]),s._v(" 一个信念")]),s._v(" "),a("p",[s._v("千万不要相信任何用户的输入！")]),s._v(" "),a("p",[s._v("无论是在前端和服务端，都要对用户的输入进行"),a("strong",[s._v("转码")]),s._v("或者"),a("strong",[s._v("过滤")]),s._v('。（需要过滤或者转码的字符："<"、">"、" " "、" \' "、"script"、"image"、"onchange"）。')]),s._v(" "),a("p",[s._v("如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你完蛋了'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("转码后变为:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("lt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("#"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("你完蛋了"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("#"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("lt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这样的代码在 html 解析的过程中是无法执行的。")]),s._v(" "),a("p",[s._v("当然也可以利用关键词过滤的方式，将 script 标签给删除。那么现在的内容只剩下:")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("什么也没有了:）")]),s._v(" "),a("h4",{attrs:{id:"利用-csp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-csp"}},[s._v("#")]),s._v(" 利用 "),a("code",[s._v("CSP")])]),s._v(" "),a("p",[a("code",[s._v("CSP")]),s._v("，即浏览器中的内容安全策略，它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能:")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("限制")]),s._v("其他域下的资源加载。")]),s._v(" "),a("li",[a("strong",[s._v("禁止")]),s._v("向其它域提交数据。")]),s._v(" "),a("li",[s._v("提供"),a("strong",[s._v("上报机制")]),s._v("，能帮助我们及时发现 XSS 攻击。")])]),s._v(" "),a("h4",{attrs:{id:"利用-httponly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-httponly"}},[s._v("#")]),s._v(" 利用 HttpOnly")]),s._v(" "),a("p",[s._v("很多 XSS 攻击脚本都是用来窃取Cookie, 而设置 Cookie 的 HttpOnly 属性后，JavaScript 便无法读取 Cookie 的值。这样也能很好的防范 XSS 攻击。")]),s._v(" "),a("h3",{attrs:{id:"react-如何防止-xss："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-如何防止-xss："}},[s._v("#")]),s._v(" "),a("strong",[a("code",[s._v("React")]),s._v(" 如何防止 "),a("code",[s._v("XSS")])]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-react line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<div bgcolor=\"#ffa7c4\">hi</div>\n// babel 转义为 React.createElement(\"div\", { bgcolor: '#ffa7c4' }, \"hi\")，返回一个 ReactElment对象\n{\n  type: 'marquee',\n  props: {\n    bgcolor: '#ffa7c4',\n    children: 'hi',\n  },\n  key: null,\n  ref: null,\n  $$typeof: Symbol.for('react.element'), // 🧐 Who dis\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("它被赋值为 "),a("code",[s._v("REACT_ELEMENT_TYPE")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REACT_ELEMENT_TYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" Symbol "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'function'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("for "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'react.element'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xeac7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("要明确的一点是，React 会将字符串转义为文字内容：")]),s._v(" "),a("div",{staticClass:"language-react line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<p>\n  {message.text}\n</p>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("要想在 React 中通过字符串编写 html 内容，就要用到 "),a("strong",[a("code",[s._v("dangerouslySetInnerHTML: { __html: ''}")])])]),s._v(" "),a("p",[s._v("试想这样一种情况，服务器允许用户储存任意的 "),a("strong",[a("code",[s._v("JSON 数据")])]),s._v("。那么就可以手动构建 React Element 对象传入到元素中。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" expectedTextButGotJSON "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dangerouslySetInnerHTML"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      __html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/* put your exploit here */'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" expectedTextButGotJSON "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Dangerous in React 0.13")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("strong",[a("code",[s._v("JSON")]),s._v("中不能存储 "),a("code",[s._v("Symbol")]),s._v("类型的变量。")])]),s._v(" "),a("p",[a("code",[s._v("ReactElement.isValidElement")]),s._v("函数用来判断一个 "),a("code",[s._v("React")]),s._v("组件是否是有效的，下面是它的具体实现。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("ReactElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("isValidElement")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" object "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'object'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" object "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REACT_ELEMENT_TYPE")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以看到 React 会把没有 "),a("strong",[a("code",[s._v("$$typeof")])]),s._v(" 标识的元素过滤掉。")])])}],!1,null,null,null);t.default=n.exports}}]);