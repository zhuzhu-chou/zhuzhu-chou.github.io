(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{234:function(s,a,t){"use strict";t.r(a);var e=t(0),r=Object(e.a)({},(function(){var s=this.$createElement;this._self._c;return this._m(0)}),[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h3",{attrs:{id:"代理服务器的作用："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器的作用："}},[s._v("#")]),s._v(" 代理服务器的作用：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("负载均衡："),t("strong",[s._v("无论后面多少源服务器，IP 是多少，都向服务器屏蔽，代理服务器（服务、负载均衡器）采用一定的")]),s._v("算法")]),s._v("（随机算法、轮询、一致性 hash、LRU（最近最少使用）等等）分发请求")]),s._v(" "),t("li",[t("strong",[s._v("保障安全："),t("strong",[s._v("利用")]),s._v("心跳机制")]),s._v("监控后台的服务器，一旦发现故障机就踢出集群")]),s._v(" "),t("li",[s._v("**缓存代理：**将内容缓存到代理服务器，使得客户端可以直接从代理服务器获得而不用到原服务器那里")])]),s._v(" "),t("h3",{attrs:{id:"相关字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关字段"}},[s._v("#")]),s._v(" 相关字段")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[t("code",[s._v("via")])]),s._v("：由"),t("strong",[s._v("代理服务器")]),s._v("添加，适用于正向和反向。可以用来追踪消息转发请求，防止循环请求。")]),s._v(" "),t("div",{staticClass:"language-http line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-http"}},[t("code",[s._v("// \n"),t("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("via:")]),s._v(" 1.1 p.example.net\n"),t("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("via:")]),s._v(" 1.1 proxy_server1，1.1 proxy_server2(服务器别名)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[t("code",[s._v("x-forwarded-for")])])]),s._v(" "),t("p",[s._v("字面意思是"),t("strong",[s._v("为谁转发")]),s._v("，在消息流从客户端流向服务器的过程中被拦截的情况下，服务器端的访问日志只能记录代理服务器或者负载均衡服务器的 IP 地址。如果想要获取最初发起请求的客户端的 IP 地址的话，XFF 就起到作用了。")]),s._v(" "),t("div",{staticClass:"language-http line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-http"}},[t("code",[s._v("// 经过多个代理服务器，代理服务器 ip 会依次记录在内，最左端表示发起请求，最右端表示最近的代理服务器\n"),t("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("x-forwarded-for:")]),s._v(" 203.0.113.195, 70.41.3.18, 150.172.238.178\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[t("code",[s._v("x-forwarded-host")])]),s._v("、"),t("strong",[t("code",[s._v("x-forwarded-proto")])]),s._v("：用来确定发起请求的客户端的域名和协议。")])])]),s._v(" "),t("h3",{attrs:{id:"xff-的两个问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xff-的两个问题"}},[s._v("#")]),s._v(" "),t("code",[s._v("XFF")]),s._v(" 的两个问题")]),s._v(" "),t("p",[t("code",[s._v("XFF")]),s._v(" 记录每一个请求方的 IP，没经过一个代理服务器都要改变该字段，产生如下问题")]),s._v(" "),t("ul",[t("li",[s._v("代理必须解析 HTTP 请求头，然后修改，比直接转发请求性能下降")]),s._v(" "),t("li",[s._v("在 "),t("code",[s._v("HTTPS")]),s._v(" 加密信道传输，原始报文不允许修改")])]),s._v(" "),t("p",[s._v("由此产生"),t("strong",[s._v("代理协议")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// PROXY + TCP4/TCP6 + 请求方地址 + 接收方地址 + 请求端口 + 接收端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PROXY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}],!1,null,null,null);a.default=r.exports}}]);