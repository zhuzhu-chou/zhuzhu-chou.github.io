(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{235:function(s,t,e){"use strict";e.r(t);var a=e(0),r=Object(a.a)({},(function(){var s=this.$createElement;this._self._c;return this._m(0)}),[function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"content"},[e("p",[s._v("目的是当流量巨大的时候减缓源服务器的压力。机制原理：代理服务器接管一部分服务端 HTTP 缓存，客户端缓存过期后就近到代理缓存中获取，代理缓存过期后才请求源服务器。")]),s._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("基于 "),e("strong",[e("code",[s._v("cache-control")])]),s._v(" 字段来控制")])]),s._v(" "),e("h3",{attrs:{id:"源服务器的缓存控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源服务器的缓存控制"}},[s._v("#")]),s._v(" 源服务器的缓存控制")]),s._v(" "),e("blockquote",[e("p",[s._v("以下响应都只能应用于 "),e("strong",[e("code",[s._v("Response Cache-control")])])])]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("public")])]),s._v(" 和 "),e("strong",[e("code",[s._v("private")])]),s._v("："),e("code",[s._v("cache-control")]),s._v(" 设置为 "),e("code",[s._v("private")]),s._v(" 则不允许代理服务器缓存，另外说一下，代理缓存属于共享缓存，一些隐私数据很容易被获取，则设置 "),e("code",[s._v("private")]),s._v(" 也是很必要的。")]),s._v(" "),e("li",[e("strong",[e("code",[s._v("proxy-revalidate")])]),s._v("：")]),s._v(" "),e("li",[e("strong",[e("code",[s._v("s-maxage")])]),s._v("：s 是 "),e("strong",[s._v("share")]),s._v(" 的意思，限定了缓存在"),e("strong",[s._v("代理服务器")]),s._v("中可以存放多久，和限制客户端缓存时间的 max-age 并不冲突。")])]),s._v(" "),e("div",{staticClass:"language-http line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Cache-Control:")]),s._v(" public, max-age=1000, s-maxage=2000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"客户端的缓存控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端的缓存控制"}},[s._v("#")]),s._v(" 客户端的缓存控制")]),s._v(" "),e("blockquote",[e("p",[s._v("以下缓存仅用于 "),e("strong",[e("code",[s._v("Resquest Cache-Control")])])])]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("code",[s._v("max-stale")])]),s._v(" 和 "),e("strong",[e("code",[s._v("min-fresh")])])]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 表示客户端能接受过期时间在5s内的代理缓存。")]),s._v("\ncache"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" max"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stale"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 表示代理缓存需要一定的新鲜度，一定要在到期前5s之前的时间拿。")]),s._v("\ncache"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" min"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fresh"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])]),s._v(" "),e("li",[e("p",[e("strong",[e("code",[s._v("only-if-cached")])])]),s._v(" "),e("p",[s._v("表示客户端只会接受代理缓存，而不会把请求发到源服务器。如果代理缓存失效，则直接返回 "),e("strong",[s._v("504（"),e("code",[s._v("Gateway Timeout")]),s._v("）")])])])])])}],!1,null,null,null);t.default=r.exports}}]);